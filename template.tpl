___TERMS_OF_SERVICE___

By creating or modifying this file you agree to Google Tag Manager's Community
Template Gallery Developer Terms of Service available at
https://developers.google.com/tag-manager/gallery-tos (or such other URL as
Google may provide), as modified from time to time.


___INFO___

{
  "type": "TAG",
  "id": "cvt_temp_public_id",
  "version": 1,
  "securityGroups": [],
  "displayName": "Sealmetrics Tracking",
  "brand": {
    "id": "brand_sealmetrics",
    "displayName": "Sealmetrics",
    "thumbnail": "data:image/png;base64,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\u003d\u003d"
  },
  "description": "Track pageviews, microconversions, and conversions with Sealmetrics cookieless analytics. GDPR-compliant tracking without cookies.",
  "categories": [
    "ANALYTICS",
    "CONVERSIONS"
  ],
  "containerContexts": [
    "WEB"
  ]
}


___TEMPLATE_PARAMETERS___

[
  {
    "type": "SELECT",
    "name": "eventType",
    "displayName": "Event Type",
    "macrosInSelect": false,
    "selectItems": [
      {
        "value": "pageview",
        "displayValue": "Pageview"
      },
      {
        "value": "microconversion",
        "displayValue": "Microconversion (Add to Cart, Form Submit, etc.)"
      },
      {
        "value": "conversion",
        "displayValue": "Conversion (Purchase, Lead, etc.)"
      }
    ],
    "simpleValueType": true,
    "defaultValue": "pageview",
    "help": "Select the type of event to track. Pageview for page loads, Microconversion for intermediate actions, Conversion for completed goals."
  },
  {
    "type": "TEXT",
    "name": "accountId",
    "displayName": "Account ID",
    "simpleValueType": true,
    "valueValidators": [
      {
        "type": "NON_EMPTY"
      }
    ],
    "help": "Your Sealmetrics Account ID. You can find it in your Sealmetrics dashboard under Settings.",
    "alwaysInSummary": true
  },
  {
    "type": "TEXT",
    "name": "label",
    "displayName": "Event Label",
    "simpleValueType": true,
    "help": "A descriptive name for this event (e.g., \u0027purchase\u0027, \u0027add_to_cart\u0027, \u0027newsletter_signup\u0027).",
    "enablingConditions": [
      {
        "paramName": "eventType",
        "paramValue": "microconversion",
        "type": "EQUALS"
      },
      {
        "paramName": "eventType",
        "paramValue": "conversion",
        "type": "EQUALS"
      }
    ],
    "valueValidators": [
      {
        "type": "NON_EMPTY"
      }
    ],
    "alwaysInSummary": true
  },
  {
    "type": "TEXT",
    "name": "amount",
    "displayName": "Conversion Value",
    "simpleValueType": true,
    "help": "The monetary value of this conversion (e.g., \u002799.99\u0027). Leave empty if not applicable.",
    "enablingConditions": [
      {
        "paramName": "eventType",
        "paramValue": "conversion",
        "type": "EQUALS"
      }
    ],
    "valueHint": "99.99"
  },
  {
    "type": "TEXT",
    "name": "contentGrouping",
    "displayName": "Content Grouping",
    "simpleValueType": true,
    "help": "Optional. Group pages by category (e.g., \u0027blog\u0027, \u0027product\u0027, \u0027checkout\u0027).",
    "enablingConditions": [
      {
        "paramName": "eventType",
        "paramValue": "pageview",
        "type": "EQUALS"
      }
    ],
    "valueHint": "blog"
  },
  {
    "type": "CHECKBOX",
    "name": "ignorePageview",
    "checkboxText": "Don\u0027t count as pageview",
    "simpleValueType": true,
    "help": "Enable this to prevent this event from being counted as a pageview. Recommended for events triggered on the same page as a pageview tag.",
    "enablingConditions": [
      {
        "paramName": "eventType",
        "paramValue": "microconversion",
        "type": "EQUALS"
      },
      {
        "paramName": "eventType",
        "paramValue": "conversion",
        "type": "EQUALS"
      }
    ],
    "defaultValue": true
  },
  {
    "type": "CHECKBOX",
    "name": "superPrivacy",
    "checkboxText": "Enable Super-Privacy Tracking",
    "simpleValueType": true,
    "help": "When enabled, tracking works in aggregated-data mode without attributing conversions to traffic sources. Use this for maximum privacy compliance. When disabled (default), conversions are attributed to their traffic source (UTM, referrer, etc.).",
    "defaultValue": false
  },
  {
    "type": "GROUP",
    "name": "propertiesGroup",
    "displayName": "Custom Properties",
    "groupStyle": "ZIPPY_CLOSED",
    "subParams": [
      {
        "type": "SIMPLE_TABLE",
        "name": "properties",
        "displayName": "Properties",
        "simpleTableColumns": [
          {
            "defaultValue": "",
            "displayName": "Property Name",
            "name": "key",
            "type": "TEXT",
            "valueHint": "product-id"
          },
          {
            "defaultValue": "",
            "displayName": "Property Value",
            "name": "value",
            "type": "TEXT",
            "valueHint": "12345"
          }
        ],
        "help": "Add custom properties to attach additional data to this event. Use kebab-case for property names (e.g., \u0027product-id\u0027, \u0027payment-method\u0027)."
      }
    ],
    "enablingConditions": [
      {
        "paramName": "eventType",
        "paramValue": "microconversion",
        "type": "EQUALS"
      },
      {
        "paramName": "eventType",
        "paramValue": "conversion",
        "type": "EQUALS"
      }
    ]
  }
]


___SANDBOXED_JS_FOR_WEB_TEMPLATE___

const log = require('logToConsole');
const injectScript = require('injectScript');
const setInWindow = require('setInWindow');
const copyFromWindow = require('copyFromWindow');
const callInWindow = require('callInWindow');
const makeTableMap = require('makeTableMap');
const getType = require('getType');

// Configuration object for Sealmetrics
const config = {
  account: data.accountId,
  event: data.eventType
};

// Add use_session only when Super-Privacy is disabled (default behavior)
if (!data.superPrivacy) {
  config.use_session = 1;
}

// Add label for microconversions and conversions
if (data.eventType !== 'pageview' && data.label) {
  config.label = data.label;
}

// Add amount for conversions
if (data.eventType === 'conversion' && data.amount) {
  config.amount = data.amount;
}

// Add content grouping for pageviews
if (data.eventType === 'pageview' && data.contentGrouping) {
  config.content_grouping = data.contentGrouping;
}

// Add ignore_pageview flag
if (data.eventType !== 'pageview' && data.ignorePageview) {
  config.ignore_pageview = 1;
}

// Add custom properties
if (data.properties && getType(data.properties) === 'array' && data.properties.length > 0) {
  const propertiesObj = makeTableMap(data.properties, 'key', 'value');
  config.properties = propertiesObj;
}

// Set the configuration in window.oSm
setInWindow('oSm', config, true);

// URL of the Sealmetrics tracker script
const trackerUrl = 'https://app.sealmetrics.com/tag/tracker';

// Inject the Sealmetrics tracker script
injectScript(trackerUrl, data.gtmOnSuccess, data.gtmOnFailure);


___WEB_PERMISSIONS___

[
  {
    "instance": {
      "key": {
        "publicId": "logging"
      },
      "param": [
        {
          "key": "environments",
          "value": {
            "type": 1,
            "string": "debug"
          }
        }
      ]
    },
    "clientAnnotations": {
      "isEditedByUser": true
    },
    "isRequired": true
  },
  {
    "instance": {
      "key": {
        "publicId": "inject_script"
      },
      "param": [
        {
          "key": "urls",
          "value": {
            "type": 2,
            "listItem": [
              {
                "type": 1,
                "string": "https://app.sealmetrics.com/*"
              }
            ]
          }
        }
      ]
    },
    "clientAnnotations": {
      "isEditedByUser": true
    },
    "isRequired": true
  },
  {
    "instance": {
      "key": {
        "publicId": "access_globals"
      },
      "param": [
        {
          "key": "keys",
          "value": {
            "type": 2,
            "listItem": [
              {
                "type": 3,
                "mapKey": [
                  {
                    "type": 1,
                    "string": "key"
                  },
                  {
                    "type": 1,
                    "string": "read"
                  },
                  {
                    "type": 1,
                    "string": "write"
                  },
                  {
                    "type": 1,
                    "string": "execute"
                  }
                ],
                "mapValue": [
                  {
                    "type": 1,
                    "string": "oSm"
                  },
                  {
                    "type": 8,
                    "boolean": true
                  },
                  {
                    "type": 8,
                    "boolean": true
                  },
                  {
                    "type": 8,
                    "boolean": false
                  }
                ]
              },
              {
                "type": 3,
                "mapKey": [
                  {
                    "type": 1,
                    "string": "key"
                  },
                  {
                    "type": 1,
                    "string": "read"
                  },
                  {
                    "type": 1,
                    "string": "write"
                  },
                  {
                    "type": 1,
                    "string": "execute"
                  }
                ],
                "mapValue": [
                  {
                    "type": 1,
                    "string": "smTrackerLoaded"
                  },
                  {
                    "type": 8,
                    "boolean": true
                  },
                  {
                    "type": 8,
                    "boolean": false
                  },
                  {
                    "type": 8,
                    "boolean": false
                  }
                ]
              },
              {
                "type": 3,
                "mapKey": [
                  {
                    "type": 1,
                    "string": "key"
                  },
                  {
                    "type": 1,
                    "string": "read"
                  },
                  {
                    "type": 1,
                    "string": "write"
                  },
                  {
                    "type": 1,
                    "string": "execute"
                  }
                ],
                "mapValue": [
                  {
                    "type": 1,
                    "string": "sm.tracker.track"
                  },
                  {
                    "type": 8,
                    "boolean": true
                  },
                  {
                    "type": 8,
                    "boolean": false
                  },
                  {
                    "type": 8,
                    "boolean": true
                  }
                ]
              },
              {
                "type": 3,
                "mapKey": [
                  {
                    "type": 1,
                    "string": "key"
                  },
                  {
                    "type": 1,
                    "string": "read"
                  },
                  {
                    "type": 1,
                    "string": "write"
                  },
                  {
                    "type": 1,
                    "string": "execute"
                  }
                ],
                "mapValue": [
                  {
                    "type": 1,
                    "string": "sm"
                  },
                  {
                    "type": 8,
                    "boolean": true
                  },
                  {
                    "type": 8,
                    "boolean": false
                  },
                  {
                    "type": 8,
                    "boolean": false
                  }
                ]
              }
            ]
          }
        }
      ]
    },
    "clientAnnotations": {
      "isEditedByUser": true
    },
    "isRequired": true
  }
]


___TESTS___

scenarios: []


___NOTES___

Sealmetrics Tracking Template v1.0

This template allows you to track:
- Pageviews: Basic page load tracking
- Microconversions: Intermediate actions like add-to-cart, form submissions
- Conversions: Completed goals like purchases, leads, sign-ups

For more information, visit: https://www.sealmetrics.com
Documentation: https://docs.sealmetrics.com

Created by Sealmetrics Team


